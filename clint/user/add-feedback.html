<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./../../server/static/images/logoIcon.jpg" type="image/x-icon">
    <title data-translate-key="feedbackTitle">قصر زهور الأماني - أضف تقييمك</title>
    <link rel="stylesheet" href="./../../server/static/css/style.css">
    <link rel="stylesheet" href="./../../server/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<header class="navbar"><div class="brand-name" data-translate-key="brandName">قصر زهور الأماني</div><br></header>
    <button id="language-switcher" class="lang-switcher">EN / عربي</button>
<main class="content">
        <section class="form-section">
            <h2 data-translate-key="feedbackFormTitle">مشاركة رأيك</h2>
            <form id="feedbackForm">
                <div class="form-group">
                    <label for="name" data-translate-key="yourName">اسمك:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="number" data-translate-key="yourNumber">رقم هاتفك:</label>
                    <input type="tel" id="number" name="number" required>
                </div>
                <div class="form-group" style="display:none;">
                    <label for="condition" data-translate-key="condition">الحالة:</label>
                    <input type="text" id="condition" name="condition" value="جديد" readonly>
                </div>
                <div class="form-group">
                    <label for="email" data-translate-key="yourEmail">بريدك الإلكتروني (اختياري):</label>
                    <input type="email" id="email" name="email">
                </div>
                <div class="form-group">
                    <label for="rating" data-translate-key="yourRating">تقييمك:</label>
                    <div class="rating">
                        <input type="radio" id="star5" name="rating" value="5"><label for="star5" title="5 stars"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star4" name="rating" value="4"><label for="star4" title="4 stars"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star3" name="rating" value="3"><label for="star3" title="3 stars"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star2" name="rating" value="2"><label for="star2" title="2 stars"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star1" name="rating" value="1"><label for="star1" title="1 star"><i class="fas fa-star"></i></label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="comments" data-translate-key="yourComments">تعليقاتك (رسالة):</label>
                    <textarea id="comments" name="feedback" rows="5"></textarea>
                </div>
                <button type="submit" class="submit-btn" data-translate-key="submitFeedback">إرسال التقييم</button>
            </form>
        </section>
    </main>


<footer class="site-footer">
        <div class="social-links">
            <a href="https://www.facebook.com/123flowerking/"><i class="fab fa-facebook-f"></i></a>
            <a href="https://www.instagram.com/al_amany_flower/"><i class="fab fa-instagram"></i></a>
            <a href="https://www.tiktok.com/@alamanyflower?is_from_webapp=1&sender_device=pc"><i class="fab fa-tiktok"></i></a>
            <a href="https://wa.me/201121721735"><i class="fab fa-whatsapp"></i></a>
        </div>
        <p data-translate-key="allRightsReserved">© 2025 Techno Scince. All rights reserved.</p>
    </footer>
    <nav class="bottom-nav">
        <a href="./../../index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span data-translate-key="home">الرئيسية</span>
        </a>
        <a href="./wishlist.html" class="nav-item" >
            <i class="fas fa-heart"></i>
            <span data-translate-key="likes">الإعجابات</span>
        </a>
        <a href="./cart.html" class="nav-item">
            <i class="fas fa-shopping-basket"></i>
            <span data-translate-key="cart">السلة</span>
        </a>
        <a href="./view-products.html" class="nav-item">
            <i class="fas fa-store"></i>
            <span data-translate-key="admin">المتجر</span>
        </a>
        <button class="nav-item hamburger-menu-btn">
            <i class="fas fa-bars"></i>
            <span data-translate-key="menu">القائمة</span>
        </button>
    </nav>
    <div class="side-menu">
        <h1>قصر زهور الأماني</h1>
        <br><br><br><br><br>
        <ul>
            <li><a href="./about.html" data-translate-key="aboutUs">من نحن </a></li>
            <li><a href="./add-feedback.html" data-translate-key="contactUs">شاركنا برأيك</a></li>
            <li><a href="./view-products.html" data-translate-key="faq">اكمل طلبك</a></li>
            <li><a href="./../admin/admin-dashboard.html" data-translate-key="adminDashboard">تسجيل دخول المدير</a></li>
        </ul>        
        <br><br><br><br><br>
        <button class="close-side-menu">close</button>
    </div>
<script src="./../../server/script.js"></script>

     <script>
        document.addEventListener('DOMContentLoaded', () => {
            const feedbackForm = document.getElementById('feedbackForm');
            // تأكد من أن هذا هو رابط النشر (Deploy) الخاص بسكريبت Google Apps الخاص بك
            const googleAppsScriptURL = 'https://script.google.com/macros/s/AKfycbxmzFGH3Oke-wO6iTd3g0rJPuhKV2Q6uJ5em_NMRQ-BzYjjd_O79LKQPvB9tSEBSgU/exec';

            if (feedbackForm) {
                feedbackForm.addEventListener('submit', async (e) => {
                    e.preventDefault(); // منع الإرسال الافتراضي للنموذج

                    const submitButton = feedbackForm.querySelector('button[type="submit"]');
                    submitButton.disabled = true; // تعطيل الزر لمنع الإرسال المتعدد
                    submitButton.textContent = 'جاري الإرسال...'; // تغيير نص الزر

                    // جمع البيانات من النموذج
                    const name = document.getElementById('name').value;
                    const number = document.getElementById('number').value;
                    const comments = document.getElementById('comments').value; // محتوى التعليقات/الرسالة
                    const selectedRating = document.querySelector('input[name="rating"]:checked'); // الحصول على النجمة المحددة

                    // قيمة التقييم (النجوم)
                    const ratingValue = selectedRating ? selectedRating.value : ''; // إذا لم يتم تحديد تقييم، أرسل سلسلة فارغة

                    // إنشاء كائن FormData لإرسال البيانات
                    const formData = new FormData();
                    formData.append('name', name);
                    formData.append('number', number);
                    formData.append('feedback', comments); // هذا يذهب إلى عمود 'feedback'
                    formData.append('condition', ratingValue);

                    try {
                        const response = await fetch(googleAppsScriptURL, {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (result.result === 'success') {
                            // استخدام ترجمة مناسبة أو رسالة افتراضية
                            alert(translations[localStorage.getItem('preferredLang') || 'ar']?.feedbackAddedSuccess || 'تم إرسال تقييمك بنجاح!');
                            feedbackForm.reset(); // إعادة تعيين النموذج بعد النجاح
                        } else {
                            console.error('حدث خطأ في Google Apps Script:', result.error);
                            alert('حدث خطأ أثناء إرسال التقييم. الرجاء المحاولة مرة أخرى.');
                        }
                    } catch (error) {
                        console.error('حدث خطأ في الاتصال:', error);
                        alert('حدث خطأ في الاتصال بالخادم. الرجاء التأكد من اتصالك بالإنترنت والمحاولة مرة أخرى.');
                    } finally {
                        submitButton.disabled = false; // إعادة تفعيل الزر
                        submitButton.textContent = 'إرسال التقييم'; // استعادة نص الزر الأصلي
                    }
                });
            }
        });
    </script>
</body>
</html>